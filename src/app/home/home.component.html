<div class="container" [ngClass]="{ 'dark-mode': isDarkMode }">
  <nav class="navbar">
    <div class="logo">Bolt Tech</div>
    <div class="nav-links">
      <a href="#" class="nav-link">หน้าแรก</a>
      <a href="#" class="nav-link">เกี่ยวกับ</a>
      <a href="#" class="nav-link">ผลงาน</a>
      <a href="#" class="nav-link">ติดต่อ</a>
      <button class="theme-toggle" (click)="toggleDarkMode()">
        <span class="material-symbols-outlined">
          {{ isDarkMode ? 'partly_cloudy_day' : 'partly_cloudy_night' }}
        </span>
      </button>
    </div>
  </nav>

  <div class="content">
    <h1>Financial Dashboard</h1>

    <div class="upload-section">
      <label for="file-upload" class="upload-label">
        <span class="material-symbols-outlined">upload_file</span>
        Upload Financial Data
      </label>
      <input 
        type="file" 
        id="file-upload" 
        (change)="onFileSelected($event)" 
        accept=".csv,.xlsx,.xls"
        [disabled]="isLoading"
      >
    </div>

    <div *ngIf="isLoading" class="loading">
      <span class="material-symbols-outlined spinning">sync</span>
      Processing your file...
    </div>

    <div class="controls-section">
      <div class="file-selection">
        <label for="file-select">เลือกไฟล์ข้อมูล:</label>
        <select *ngIf="userFiles.length > 0" [(ngModel)]="selectedFile" (ngModelChange)="onFileSelect($event)" class="form-control">
          <option value="">Select a file</option>
          <option *ngFor="let file of userFiles" [value]="file.file_id">
            {{ file.filename }}
          </option>
        </select>
      </div>

      <div class="product-selection" *ngIf="availableProducts.length > 0">
        <label for="product-select">เลือกสินค้า:</label>
        <select [(ngModel)]="selectedProduct" (change)="fetchDashboardSummary()" class="form-control">
          <option value="">All Products</option>
          <option *ngFor="let product of availableProducts" [value]="product.Product">
            {{ product.Product }}
          </option>
        </select>
      </div>

      <!-- Month selection for daily view -->
      <div class="month-selection" *ngIf="selectedReportType === 'daily'">
        <label for="month-select">เลือกเดือน:</label>
        <select [(ngModel)]="selectedMonth" (change)="onMonthSelect(selectedMonth)" class="form-control">
          <option value="" disabled selected>-- กรุณาเลือกเดือน --</option>
          <option *ngFor="let month of availableMonths" [value]="month">
            {{ month }}
          </option>
        </select>
      </div>

      <div class="report-type-filters">
        <button 
          [class.active]="selectedReportType === 'daily'"
          (click)="setReportType('daily')"
          class="filter-btn">
          Daily
        </button>
        <button 
          [class.active]="selectedReportType === 'monthly'"
          (click)="setReportType('monthly')"
          class="filter-btn">
          Monthly
        </button>
        <button 
          [class.active]="selectedReportType === 'yearly'"
          (click)="setReportType('yearly')"
          class="filter-btn">
          Yearly
        </button>
        <button 
          [class.active]="selectedReportType === 'compare_trends'"
          (click)="setReportType('compare_trends')"
          class="filter-btn">
          Compare Trends
        </button>
        <button 
          [class.active]="selectedReportType === 'forecast'"
          (click)="setReportType('forecast')"
          class="filter-btn">
          Forecast
        </button>
      </div>

      <div class="report-type-filters" *ngIf="isCompare">
        <button 
          [class.active]="selectedReportType1 === 'daily'"
          (click)="setReportType1('daily')"
          class="filter-btn1">
          Daily
        </button>
        <button 
          [class.active]="selectedReportType1 === 'monthly'"
          (click)="setReportType1('monthly')"
          class="filter-btn1">
          Monthly
        </button>
        <button 
          [class.active]="selectedReportType1 === 'yearly'"
          (click)="setReportType1('yearly')"
          class="filter-btn1">
          Yearly
        </button>
      </div>

      <button class="btn-load-dashboard" (click)="fetchDashboardSummary()" [disabled]="!selectedFile">
        <span class="material-symbols-outlined">analytics</span>
        โหลดข้อมูล Dashboard
      </button>
    </div>

    <div *ngIf="summary" class="chart-container">
      <canvas #salesChart></canvas>
    </div>

    <div *ngIf="summary.forecast" class="chart-container">
      <canvas #forecastChart></canvas>
    </div>

    <div *ngIf="summary.top_products" class="top-products">
      <h2>Top Products</h2>
      <div class="products-grid">
        <div *ngFor="let product of summary.top_products" class="product-card">
          <h3>{{ product.Product }}</h3>
          <p>Total Sales: ฿{{ product["Total Sales"].toLocaleString() }}</p>
        </div>
      </div>
    </div>
  </div>
</div>